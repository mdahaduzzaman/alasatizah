{% extends "_base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="py-5 lg:px-20 flex flex-col md:flex-row gap-5 items-center justify-center bg-gradient-to-br from-gray-50 via-white to-gray-100">
  <div class="flex-1 max-w-md space-y-8">
    <!-- Dashboard Button Start -->
    <div class="pt-4">
      <a href="{{ dashboard_url }}"
        class="group relative block w-full text-center overflow-hidden rounded-2xl px-6 py-3 text-base font-semibold text-white bg-gradient-to-r from-indigo-600 via-blue-600 to-cyan-500 shadow-lg hover:shadow-xl hover:scale-[1.02] transition-transform duration-300">
        <span class="relative z-10 flex items-center justify-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 15.75 3 12m0 0 3.75-3.75M3 12h18" />
          </svg>
          Open Dashboard
        </span>
        <span
          class="absolute inset-0 bg-gradient-to-r from-blue-400 via-indigo-500 to-purple-500 opacity-0 group-hover:opacity-100 blur-lg transition-opacity duration-500"></span>
      </a>
    </div>
    <!-- Dashboard Button End -->

    <!-- Profile Completion Start -->
    <div class="p-6 bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition">
      <h2 class="text-xl font-semibold text-gray-800 mb-3 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield-check-icon lucide-shield-check"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/><path d="m9 12 2 2 4-4"/></svg>

        Profile Completion
      </h2>

      <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
        <div class="bg-gradient-to-r from-blue-500 to-indigo-600 h-3 rounded-full transition-all duration-700 ease-out"
          style="width: {{ profile_completed_percentage }}%;"></div>
      </div>

      <p class="mt-3 text-sm font-medium text-gray-600 flex justify-between">
        <span>Progress</span>
        <span class="text-blue-600 font-semibold">{{ profile_completed_percentage }}%</span>
      </p>
    </div>
    <!-- Profile Completion End -->

    <!-- Profile Update Links Start -->
    <div>
      {% if ustaz %}
      <a href="{% url 'ustaz/complete-profile' %}"
        class="block text-center px-5 py-3 text-sm font-semibold text-white bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-xl shadow-md hover:shadow-lg hover:opacity-90 transition">
        Update Ustaz Profile
      </a>
      {% endif %}
      {% if organization %}
      <a href="{% url 'organization/complete-profile' %}"
        class="block text-center px-5 py-3 text-sm font-semibold text-white bg-gradient-to-r from-blue-500 via-cyan-500 to-teal-500 rounded-xl shadow-md hover:shadow-lg hover:opacity-90 transition">
        Update Organization Profile
      </a>
      {% endif %}
      {% if guardian %}
      <a href="{% url 'guardian/complete-profile' %}"
        class="block text-center px-5 py-3 text-sm font-semibold text-white bg-gradient-to-r from-emerald-500 via-green-500 to-lime-500 rounded-xl shadow-md hover:shadow-lg hover:opacity-90 transition">
        Update Guardian Profile
      </a>
      {% endif %}
    </div>
    <!-- Profile Update Links End -->

  </div>

  <div class="flex-1">
    <!-- Update Profile Card Start -->
    <div class="max-w-md w-full space-y-6 bg-white p-6 rounded shadow">
      <h2 class="text-center text-2xl font-bold">Update Profile</h2>
      <div class="w-20 h-20 border border-primary mx-auto rounded-full overflow-hidden">
        {% if request.user.avatar %}
        <img src="{{ request.user.avatar.url }}" alt="Current Avatar" class="w-full h-full object-cover cursor-pointer"
          id="avatar-preview" onclick="document.getElementById('id_avatar').click()">
        {% else %}
        <div class="w-full h-full bg-secondary flex items-center text-center justify-center text-gray-500 cursor-pointer"
          id="avatar-preview" onclick="document.getElementById('id_avatar').click()">
          No Picture
        </div>
        {% endif %}
      </div>
      <form method="post" enctype="multipart/form-data" class="space-y-4">
        {% csrf_token %}
        <!-- Avatar Field -->
        <div class="">
          <!-- Only the input box is rendered here -->
          <label for="{{ form.avatar.id_for_label }}" class="block mb-1 text-sm font-medium">
            {{ form.avatar.label }}
            {% if form.avatar.field.required %}
            <span class="text-red-500">*</span>
            {% endif %}
          </label>
          {{ form.avatar|add_class:"py-2" }}
    
          {% if form.avatar.errors %}
          <p class="text-red-500 text-sm mt-1">{{ form.avatar.errors.0 }}</p>
          {% endif %}
        </div>
        <!-- Name Field -->
        <div class="mb-4">
          <label for="{{ form.name.id_for_label }}" class="block mb-1 text-sm font-medium">
            {{ form.name.label }}
            {% if form.name.field.required %}
            <span class="text-red-500">*</span>
            {% endif %}
          </label>
          {{ form.name|add_class:"w-full px-3 py-2 border rounded-md" }}
          {% if form.name.errors %}
          <p class="text-red-500 text-sm mt-1">{{ form.name.errors.0 }}</p>
          {% endif %}
        </div>
        <!-- Phone Field -->
        <div class="mb-4">
          <label for="{{ form.phone.id_for_label }}" class="block mb-1 text-sm font-medium">
            {{ form.phone.label }}
            {% if form.phone.field.required %}
            <span class="text-red-500">*</span>
            {% endif %}
          </label>
          {{ form.phone|add_class:"w-full px-3 py-2 border rounded-md" }}
          {% if form.phone.errors %}
          <p class="text-red-500 text-sm mt-1">{{ form.phone.errors.0 }}</p>
          {% endif %}
        </div>
        <!-- Gender Field -->
        <div class="mb-4">
          <label for="{{ form.gender.id_for_label }}" class="block mb-1 text-sm font-medium">
            {{ form.gender.label }}
            {% if form.gender.field.required %}
            <span class="text-red-500">*</span>
            {% endif %}
          </label>
          {{ form.gender|add_class:"w-full px-3 py-2 border rounded-md" }}
          {% if form.gender.errors %}
          <p class="text-red-500 text-sm mt-1">{{ form.gender.errors.0 }}</p>
          {% endif %}
        </div>
        <button type="submit"
          class="mb-5 w-full bg-primary rounded-md text-white hover:text-primary transition-all duration-200 py-2 hover:bg-primary-foreground border border-primary">
          Save Changes
        </button>
      </form>
    </div>
    <!-- Update Profile Card End -->
  </div>
</div>





{% comment %} <div class="min-h-screen flex justify-center items-center bg-secondary py-12 px-4 sm:px-6 lg:px-8">
</div> {% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('{{ form.avatar.id_for_label }}');
    const avatarPreview = document.getElementById('avatar-preview');

    if (input && avatarPreview) {
      input.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          // Check if file is an image
          if (!file.type.match('image.*')) {
            alert('Please select an image file');
            return;
          }

          const reader = new FileReader();

          reader.onload = (e) => {
            // If preview is currently a div, replace with img
            if (avatarPreview.tagName === 'DIV') {
              const newImg = document.createElement('img');
              newImg.id = 'avatar-preview';
              newImg.className = 'w-20 h-20 rounded-full border border-gray-300 object-cover';
              newImg.src = e.target.result;
              newImg.alt = 'Avatar preview';
              avatarPreview.replaceWith(newImg);
            }
            // If preview is already an img, just update src
            else {
              avatarPreview.src = e.target.result;
            }
          };

          reader.onerror = () => {
            console.error('Error reading file');
          };

          reader.readAsDataURL(file);
        }
      });
    }
  });
</script>
{% endblock %}